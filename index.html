<!doctype html>
<html>
 <head>
  <title>Hot Drop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CRITICAL: Added Viewport Meta Tag for Mobile -->
  <script src="/_sdk/element_sdk.js"></script>
  <style>
      /* --- GLOBAL STYLES (Monochrome/Dark) --- */
      body {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        /* Dark background with slight gradient */
        background: linear-gradient(135deg, #1f1f1f 0%, #0d0d0d 100%);
        color: #e0e0e0;
        font-family: 'Inter', 'Segoe UI', 'Arial', sans-serif;
        min-height: 100%;
        display: flex;
        flex-direction: column;
      }

      html {
        height: 100%;
      }

      .app-container {
        min-height: 100%;
        display: flex;
        flex-direction: column;
      }

      /* --- HEADER STYLES (Red Accent) --- */
      .header {
        position: sticky;
        top: 0;
        z-index: 100;
        background: rgba(13, 13, 13, 0.95);
        padding: 15px 20px;
        text-align: center;
        /* Red border accent */
        border-bottom: 3px solid #ff0000; 
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(8px);
        display: flex;
        justify-content: center;
      }

      .header img {
        height: 40px; /* Adjust height for the logo */
        width: auto;
        content-visibility: auto;
      }

      /* --- GRID LAYOUT --- */
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        padding: 25px;
        max-width: 1200px;
        margin: 0 auto;
        flex-grow: 1;
      }

      /* --- VIDEO CARD STYLES --- */
      .video-card {
        background: #2a2a2a; /* Dark card background */
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid #333;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      }
      
      /* Red border on hover for focus */
      .video-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(255, 0, 0, 0.2), 0 0 0 3px #ff0000;
      }

      .video-thumbnail {
        width: 100%;
        height: 200px;
        background: #111; /* Even darker background for thumbnail */
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        color: #888;
        position: relative;
        overflow: hidden;
      }

      .video-thumbnail iframe {
        width: 100%;
        height: 100%;
        border: none;
        pointer-events: none;
      }

      /* --- SHINY PLAY BUTTON (Updated Style) --- */
      .play-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        /* Shiny Red Gradient for 3D/Shine effect */
        background: linear-gradient(145deg, #ff4d4d, #cc0000); 
        border-radius: 8px; /* Rounded rectangular button */
        padding: 10px 20px;
        width: auto; 
        height: auto;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        font-weight: 700;
        color: #ffffff;
        letter-spacing: 1px;
        transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        z-index: 10;
        /* Text shadow for a bit of 'shine' effect */
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.9);
        box-shadow: 0 4px 20px rgba(255, 0, 0, 0.7);
        border: 2px solid #ff9999; /* Lighter border for contrast */
        text-transform: uppercase;
      }
      
      /* Remove old image styling */
      .play-overlay img {
        display: none;
      }

      .video-card:hover .play-overlay {
        transform: translate(-50%, -50%) scale(1.05); /* Slight scale on hover */
        background: linear-gradient(145deg, #cc0000, #ff4d4d); /* Invert gradient on hover */
        box-shadow: 0 4px 25px rgba(255, 0, 0, 0.9);
      }

      .video-info {
        padding: 15px;
        background: #1e1e1e; /* Card footer color */
      }

      .video-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
        color: #ffffff; /* White text */
        line-height: 1.4;
      }

      .video-stats {
        display: flex;
        gap: 15px;
        font-size: 13px;
        color: #aaaaaa; /* Lighter grey text */
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 5px;
        padding: 4px 10px;
        background: #333333;
        border-radius: 15px;
        border: 1px solid #444444;
        transition: background-color 0.2s ease;
      }

      .stat-item:hover {
        background: #ff0000; /* Red hover for stats */
        color: #fff;
      }

      /* --- MODAL STYLES (Vertical Scroll/Swipe) --- */
      .video-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(12px);
        z-index: 1000;
        display: none; 
        /* Enable vertical scrolling and mandatory scroll-snapping */
        overflow-y: scroll;
        scroll-snap-type: y mandatory;
        -webkit-overflow-scrolling: touch; 
        padding: 0;
      }

      .modal-content {
        /* Holds all video slides */
        width: 100%;
        max-width: none;
        max-height: none;
        background: transparent;
        border-radius: 0;
        overflow: visible;
        border: none;
        box-shadow: none;
        display: flex;
        flex-direction: column;
      }
      
      /* The individual full-screen video container */
      .video-slide {
        width: 100%;
        min-height: 100vh; /* Each slide takes up the full viewport height */
        display: flex;
        flex-direction: column;
        justify-content: center; 
        align-items: center;
        scroll-snap-align: start; /* Snap to the start of the slide */
        padding: 20px;
        box-sizing: border-box;
      }

      /* Wrapper to give the video content a centered, mobile-feed-like frame */
      .slide-wrapper {
        width: 100%;
        max-width: 500px; /* Max width suitable for vertical video */
        height: 100%;
        max-height: 90vh; /* Max height for content */
        background: #111;
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        border: 4px solid #ff0000;
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
      }
      
      .modal-video-container {
        width: 100%;
        flex-grow: 1; 
        position: relative;
        height: 100%;
        background: #000;
      }

      /* The iframe itself */
      .video-player {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      .modal-info {
        padding: 20px;
        background: #1a1a1a;
        flex-shrink: 0; 
      }

      .modal-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 10px;
        color: #ffffff;
      }

      .modal-stats {
        display: flex;
        gap: 20px;
        font-size: 14px;
        color: #aaaaaa;
      }

      .close-btn {
        /* Fixed close button for easy access */
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff0000;
        border: none;
        color: white;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease, background-color 0.2s ease;
        z-index: 1001; /* Above modal content */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      }

      .close-btn:hover {
        background: #e60000;
        transform: scale(1.1) rotate(90deg);
      }

      /* --- MEDIA QUERIES (Responsiveness) --- */
      @media (max-width: 768px) {
        .video-grid {
          gap: 15px;
          padding: 15px;
        }
        
        .header img {
          height: 30px;
        }
        .video-slide {
            padding: 10px;
        }
        .slide-wrapper {
            max-width: 100%; /* Use full width on small screens */
            max-height: 100vh;
        }
      }

      @media (max-width: 480px) {
        .video-grid {
          grid-template-columns: 1fr;
        }
        .modal-info {
            padding: 15px;
        }
        .modal-title {
            font-size: 18px;
        }
        .modal-stats {
            font-size: 13px;
        }
        .close-btn {
            top: 15px;
            right: 15px;
        }
      }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-container">
   <div class="header">
    <!-- Logo is placed here -->
    <img id="app-logo" src="logo.jpg" alt="Hot Drop Logo" onerror="this.onerror=null; this.src='https://placehold.co/150x40/111/fff?text=Hot+Drop'">
   </div>
   <div class="video-grid" id="videoGrid">
    <!-- Existing Video Card #1 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1zbwA5bwljAuj0XPYa8XONnLFBnKiUQAt/preview', 'Amazing Short Video #1', '1.2K', '89', '45')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1zbwA5bwljAuj0XPYa8XONnLFBnKiUQAt/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Amazing Short Video #1
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 1.2K
       </div>
       <div class="stat-item">
        üí¨ 89
       </div>
       <div class="stat-item">
        üì§ 45
       </div>
      </div>
     </div>
    </div>
    <!-- Existing Video Card #2 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1C3Kta7uHm2oou57mI_o_LtQ-GxLxWE9J/preview', 'Trending Content #2', '856', '23', '12')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1C3Kta7uHm2oou57mI_o_LtQ-GxLxWE9J/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Trending Content #2
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 856
       </div>
       <div class="stat-item">
        üí¨ 23
       </div>
       <div class="stat-item">
        üì§ 12
       </div>
      </div>
     </div>
    </div>
    <!-- Existing Video Card #3 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1ALiYnGTRg5bCRTGv9kBVXhE3jWR31p_A/preview', 'Viral Moment #3 (New)', '2.1K', '156', '78')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1ALiYnGTRg5bCRTGv9kBVXhE3jWR31p_A/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Viral Moment #3 (New)
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 2.1K
       </div>
       <div class="stat-item">
        üí¨ 156
       </div>
       <div class="stat-item">
        üì§ 78
       </div>
      </div>
     </div>
    </div>
    <!-- Existing Video Card #4 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1sONIQbAT3phSKfsOMBQcwhTgGCsrIj3o/preview', 'Epic Clip #4 (Fresh)', '634', '41', '19')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1sONIQbAT3phSKfsOMBQcwhTgGCsrIj3o/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Epic Clip #4 (Fresh)
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 634
       </div>
       <div class="stat-item">
        üí¨ 41
       </div>
       <div class="stat-item">
        üì§ 19
       </div>
      </div>
     </div>
    </div>
    <!-- Existing Video Card #5 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1RYiCzBiYPzm9I-QDQbym5J0Zg_LasnDJ/preview', 'Comedy Gold #5 (New Leak)', '3.4K', '234', '112')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1RYiCzBiYPzm9I-QDQbym5J0Zg_LasnDJ/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Comedy Gold #5 (New Leak)
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 3.4K
       </div>
       <div class="stat-item">
        üí¨ 234
       </div>
       <div class="stat-item">
        üì§ 112
       </div>
      </div>
     </div>
    </div>
    <!-- Original Video Box 6 -->
    <div class="video-card" onclick="openVideo('', 'Music Vibes #6', '1.8K', '67', '34')">
     <div class="video-thumbnail">
      üéµ 
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Music Vibes #6
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 1.8K
       </div>
       <div class="stat-item">
        üí¨ 67
       </div>
       <div class="stat-item">
        üì§ 34
       </div>
      </div>
     </div>
    </div>
    <!-- Original Video Box 7 -->
    <div class="video-card" onclick="openVideo('', 'Dance Moves #7', '945', '78', '29')">
     <div class="video-thumbnail">
      üíÉ 
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Dance Moves #7
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 945
       </div>
       <div class="stat-item">
        üí¨ 78
       </div>
       <div class="stat-item">
        üì§ 29
       </div>
      </div>
     </div>
    </div>
    <!-- Original Video Box 8 -->
    <div class="video-card" onclick="openVideo('', 'Tech Review #8', '2.7K', '189', '95')">
     <div class="video-thumbnail">
      üì± 
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Tech Review #8
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 2.7K
       </div>
       <div class="stat-item">
        üí¨ 189
       </div>
       <div class="stat-item">
        üì§ 95
       </div>
      </div>
     </div>
    </div>
    
    <!-- --- NEW VIDEO CARDS ADDED BELOW --- -->
    
    <!-- New Video Card #9 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1F5XWLjggs1RzJKHeqQIR4dCYfG4iS5j9/preview', 'Exclusive Drop #9 (Pro)', '4.5K', '321', '188')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1F5XWLjggs1RzJKHeqQIR4dCYfG4iS5j9/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Exclusive Drop #9 (Pro)
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 4.5K
       </div>
       <div class="stat-item">
        üí¨ 321
       </div>
       <div class="stat-item">
        üì§ 188
       </div>
      </div>
     </div>
    </div>
    
    <!-- New Video Card #10 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1WxonPS_L5S-h2Jnk4GLBAtDrGdc_zFQv/preview', 'Hidden Gem #10', '1.9K', '110', '55')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1WxonPS_L5S-h2Jnk4GLBAtDrGdc_zFQv/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Hidden Gem #10
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 1.9K
       </div>
       <div class="stat-item">
        üí¨ 110
       </div>
       <div class="stat-item">
        üì§ 55
       </div>
      </div>
     </div>
    </div>

    <!-- New Video Card #11 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1NFTFtJ9k06K8sv3nHmatKH7Q_no9e9fh/preview', 'POV Insider #11', '7.8K', '540', '290')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1NFTFtJ9k06K8sv3nHmatKH7Q_no9e9fh/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       POV Insider #11
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 7.8K
       </div>
       <div class="stat-item">
        üí¨ 540
       </div>
       <div class="stat-item">
        üì§ 290
       </div>
      </div>
     </div>
    </div>

    <!-- New Video Card #12 -->
    <div class="video-card" onclick="openVideo('https://drive.google.com/file/d/1dp0oSHqo4ojlOzpkEsrVjqxqQw-ZAlbw/preview', 'Breaking News #12', '1.1K', '99', '40')">
     <div class="video-thumbnail"><iframe src="https://drive.google.com/file/d/1dp0oSHqo4ojlOzpkEsrVjqxqQw-ZAlbw/preview" allow="autoplay" allowfullscreen></iframe>
      <div class="play-overlay">
       PLAY
      </div>
     </div>
     <div class="video-info">
      <div class="video-title">
       Breaking News #12
      </div>
      <div class="video-stats">
       <div class="stat-item">
        ‚ù§Ô∏è 1.1K
       </div>
       <div class="stat-item">
        üí¨ 99
       </div>
       <div class="stat-item">
        üì§ 40
       </div>
      </div>
     </div>
    </div>
   </div>
   
   <!-- Video Modal (Refactored for Vertical Swiping) -->
   <div class="video-modal" id="videoModal">
    <!-- Fixed close button outside the scrolling content -->
    <button class="close-btn" onclick="closeVideo()">√ó</button>
    <div class="modal-content" id="modalContent">
        <!-- Video Slides will be dynamically inserted here by JavaScript -->
    </div>
   </div>
   
  </div>
  <script>
      const defaultConfig = {
        app_title: "Hot Drop"
      };

      let config = { ...defaultConfig };
      let videoData = [];
      let isPlayingIndex = -1; // Track which video is currently loaded/playing
      let scrollTimer = null; // For debouncing scroll checks

      async function onConfigChange(newConfig) {
        config = { ...config, ...newConfig };
      }

      function mapToCapabilities(config) {
        return {
          recolorables: [],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        };
      }

      function mapToEditPanelValues(config) {
        return new Map([
          ["app_title", config.app_title || defaultConfig.app_title]
        ]);
      }

      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }

      /**
       * 1. Extracts video data from HTML and stores it in videoData array.
       * 2. Updates the 'onclick' attribute of each card to only pass its index.
       */
      function initializeVideos() {
        const videoCards = document.querySelectorAll('.video-card');
        
        videoData = Array.from(videoCards).map((card, index) => {
          const onclickAttr = card.getAttribute('onclick');
          // Regex to extract arguments: openVideo('url', 'title', 'likes', 'comments', 'shares')
          const match = onclickAttr.match(/openVideo\(['"]([^'"]*)['"],\s*['"]([^'"]*)['"],\s*['"]([^'"]*)['"],\s*['"]([^'"]*)['"],\s*['"]([^'"]*)['"]\)/);
          
          // IMPORTANT: Update the card's onclick handler to use the new signature
          card.setAttribute('onclick', `openVideo(${index})`);

          if (match) {
            return {
              index: index,
              url: match[1],
              title: match[2],
              likes: match[3],
              comments: match[4],
              shares: match[5]
            };
          }
          return null;
        }).filter(data => data !== null);
      }

      /**
       * Renders all video slides into the modal content container.
       */
      function renderModalSlides() {
        const modalContent = document.getElementById('modalContent');
        
        // Use map/join to efficiently build the HTML string for all slides
        modalContent.innerHTML = videoData.map(video => {
          // Store video URL in data-src. src will be set later by JS for playback.
          const videoHtml = video.url 
              ? `<iframe class="video-player" data-src="${video.url}" allow="autoplay" allowfullscreen></iframe>`
              : `<div class="video-player-fallback" style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(45deg, #222, #333); color: #888; font-size: 24px;">üö´ Video Source Not Found</div>`;

          // Template for a single full-screen video slide
          return `
              <div class="video-slide" data-index="${video.index}">
                  <div class="slide-wrapper">
                      <div class="modal-video-container">
                          ${videoHtml}
                      </div>
                      <div class="modal-info">
                          <div class="modal-title">${video.title}</div>
                          <div class="modal-stats">
                              <div class="stat-item">‚ù§Ô∏è <span>${video.likes}</span></div>
                              <div class="stat-item">üí¨ <span>${video.comments}</span></div>
                              <div class="stat-item">üì§ <span>${video.shares}</span></div>
                          </div>
                      </div>
                  </div>
              </div>
          `;
        }).join('');
      }

      /**
       * Checks which video is currently in the viewport and pauses/plays accordingly.
       */
      function checkVideoVisibility() {
        const modal = document.getElementById('videoModal');
        const slides = modal.querySelectorAll('.video-slide');
        if (slides.length === 0) return;

        // Calculate the index of the video currently snapped to the top of the viewport
        const viewportHeight = window.innerHeight;
        // Round to nearest integer to account for scroll-snap
        const scrollIndex = Math.round(modal.scrollTop / viewportHeight);

        // Prevent redundant processing if the active index hasn't changed
        if (scrollIndex === isPlayingIndex) return;
        
        isPlayingIndex = scrollIndex;
        
        slides.forEach((slide, index) => {
            const player = slide.querySelector('.video-player');
            const dataSrc = player ? player.getAttribute('data-src') : null;

            if (!player || !dataSrc) return;

            if (index === scrollIndex) {
                // PLAY: Video is in view, ensure src is set to start playback
                if (player.src !== dataSrc) {
                    player.src = dataSrc;
                }
            } else {
                // PAUSE: Video is out of view, clear src to stop playback
                if (player.src) {
                    player.src = '';
                }
            }
        });
      }
      
      /**
       * Debounced handler for scroll events. This prevents checkVideoVisibility from firing excessively.
       */
      function handleScroll() {
          clearTimeout(scrollTimer);
          scrollTimer = setTimeout(() => {
              checkVideoVisibility();
          }, 150); // Small delay to fire only after scrolling/snapping has largely settled
      }

      /**
       * Opens the modal, renders slides, and scrolls to the selected video index.
       * @param {number} selectedIndex The index of the video to open.
       */
      function openVideo(selectedIndex) {
        const modal = document.getElementById('videoModal');
        
        // 1. Render all slides before displaying the modal
        renderModalSlides();

        // 2. Show modal and hide body scroll
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // 3. Scroll to the selected video using the index and viewport height
        requestAnimationFrame(() => {
            const scrollPosition = selectedIndex * window.innerHeight;
            // Use 'instant' for initial jump. checkVideoVisibility will handle the playback state.
            modal.scrollTo({
                top: scrollPosition,
                behavior: 'instant' 
            });
            // Immediately run check after initial scroll to start the first video
            checkVideoVisibility(); 
        });

        // Add the scroll listener
        modal.addEventListener('scroll', handleScroll);
      }

      function closeVideo() {
        const modal = document.getElementById('videoModal');
        const modalContent = document.getElementById('modalContent');
        
        // Remove scroll listener
        modal.removeEventListener('scroll', handleScroll);

        // Hide modal
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // Clear content and reset state to stop all video playback and free up resources
        modalContent.innerHTML = '';
        isPlayingIndex = -1;
        clearTimeout(scrollTimer);
      }

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.getElementById('videoModal').style.display === 'flex') {
          closeVideo();
        }
      });
      
      // Run initialization when the window loads
      window.addEventListener('load', initializeVideos);
    </script>
 </body>
</html>
